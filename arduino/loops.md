# Arduino 迴圈控制

Arduino 程式的高階語言流程控制指令主要可以分成三大類，其中就包含迴圈控制指令：**for**、**while**、**do...while**。



## for 迴圈 (for loop)

`for` 迴圈是一種**前判斷型迴圈**。它設計用於在程式中重複執行一個區塊的敘述，特別是當您**預先知道需要重複的次數**時。

在 `for` 迴圈中，包含三個主要參數，以分號 `;` 區隔：初值設定、條件式、以及增量值或減量值。

| 組成部分                                 | 說明                                                         |
| ---------------------------------------- | ------------------------------------------------------------ |
| **初值設定 (Initialization)**            | 設定迴圈變數的起始值。此動作在迴圈開始時**只會執行一次**。在 `for` 語句中，循環變量初始化的操作可以在表達式1中實現。 |
| **條件式 (Condition)**                   | 判斷迴圈是否繼續執行的條件。若條件式為**真** (`true`)，則執行迴圈內的敘述。 |
| **增量值或減量值 (Increment/Decrement)** | 在每次迴圈結束時，用於修改迴圈變數的值。                     |

### 基本語法

``` c
for (初值設定; 條件式; 增量值或減量值) {
    // 條件式成立時重複執行的敘述
}
```

或在 Tinkercad Circuits 中，此功能圖塊如同 `for(initialization; condition; increment)` 指令。


### 簡單範例

以下範例展示如何使用 `for` 迴圈讓 LED 從最暗（0）慢慢變亮到最亮（255），實現淡入效果：

``` c
void loop() {
  Serial.println("由暗變亮");
  for (int i = 0; i <= 255; i++) {
    analogWrite(15, i);       // 亮度 i 從 0->255 [5]
    delay(10);
  }
  delay(1000);
}
```

這個範例使用了 `analogWrite` 函式來控制 GPIO 15 腳位的 LED 亮度，亮度值範圍預設為 0 到 255。



## while 迴圈 (while loop)

`while` 迴圈也是一種**前判斷型迴圈**。它會先判斷條件式，若條件式為真 (`true`)，則執行大括號 `{}` 中的敘述。它會不斷執行直到條件式為假 (`false`)，才結束 `while` 迴圈。

使用 `while` 循環時，循環變量初始化的操作應在 `while` 語句**之前**完成。

### 基本語法

``` c
while (條件式) {
    // 條件式成立時重複執行的敘述
}
```

### 簡單範例

以下範例展示了如何使用 `while` 迴圈計算從 1 加到 10 的總和（`s` 的結果為 55）：

``` c
void loop() {
  int i=0,s=0; // 宣告整數變數 i、s [7]

  while(i<=10) // 當 i 值小於或等於 10 時，執行 while 迴圈 [7]
  {
    s=s+i;  // s=1+2+3+⋯+10=55 [7]
    i++;    // 變數 i 值遞增 1 [7]
  }
}
```



## do-while 迴圈 (do-while loop)

`do-while` 迴圈是一種**後判斷型迴圈**。它最大的特點是會**先執行大括號** **{}** **中的敘述一次**，然後再判斷 `while` 後面的條件式。

因此，`do-while` 迴圈**至少會執行一次**敘述，即使條件式一開始就為假，內容也會被執行一次。

基本語法

``` c
do {
    // 至少執行一次的敘述 [8]
} while (條件式); // 條件式為真時繼續執行迴圈 [8]
```

### 簡單範例

以下範例展示了使用 `do-while` 迴圈計算從 1 加到 10 的總和：

``` c
void loop() {
  int i=0,s=0;  // 宣告整數變數 i、s [8]

  do     // 至少執行一次 [8]
  {
    s=s+i;   // s=1+2+3+⋯+10 [8]
    i++;   // 變數 i 值遞增 [8]
  }
  while(i<=10)   // 當 i 值小於或等於 10 時，執行 do-while 迴圈 [8]
}
```



## 迴圈控制的共通點

無論是 `while` 循環、`do-while` 循環還是 `for` 循環，都可以使用 `break` 語句跳出循環，或使用 `continue` 語句結束本次循環。

在 Arduino 程式設計中，`loop()` 函式本身就是一個**無窮迴圈**，它會不斷重複執行，直到電力移除或被外部力量停止。這類似於一個被設計成永遠運行的 `while(true)` 結構。當您在 `loop()` 函式內部使用上述迴圈結構時，它們提供了更精確的、具有終止條件的流程控制。

此外，如果您的程式是使用 ESP32 的多核心架構，在設定新的任務內容時，該任務（例如 `Taskcode` 副程式）內部必須使用一個**無窮迴圈**，通常寫為 `for(;;)`，且不允許 `return`，否則會出現程式錯誤。在這種任務內，必須至少有一個 `delay()` 或類似的釋放執行權的指令，否則會導致程式鎖死。

